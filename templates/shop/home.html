{% extends 'base.html' %}
{% load static %}
{% block title %}Shop | Construction Supply Store{% endblock %}
{% block content %}
<div class="row mb-4">
    <div class="col-md-8">
        <div class="d-flex align-items-center mb-3">
            <div>
                <h1 class="fw-bold">Order building materials with confidence</h1>
                <p class="text-muted mb-0">Check real-time stock levels and place quick orders online. We'll confirm pickup or delivery with you.</p>
            </div>
        </div>
    </div>
    <div class="col-md-4 text-md-end">
        <a class="btn btn-outline-primary" href="{{ store_map_url }}" target="_blank" rel="noopener">Get directions</a>
    </div>
</div>
<div class="row g-3">
    {% for item in items %}
        <div class="col-md-4">
            <div class="card h-100 shadow-sm">
                <div class="card-body d-flex flex-column">
                    <h5 class="card-title fw-bold">{{ item.name }}</h5>
                    <p class="text-muted small flex-grow-1">{{ item.description|default:'No description provided yet.' }}</p>
                    <p class="mb-1"><strong>${{ item.price }}</strong></p>
                    <p class="mb-2"><span class="badge {% if item.in_stock %}bg-success{% else %}bg-secondary{% endif %}">{% if item.in_stock %}In stock ({{ item.quantity }}){% else %}Out of stock{% endif %}</span></p>
                    <form method="post" class="mt-auto">
                        {% csrf_token %}
                        {{ order_form.customer_name.label_tag }}
                        {{ order_form.customer_name }}
                        {{ order_form.customer_email.label_tag }}
                        {{ order_form.customer_email }}
                        <input type="hidden" name="item" value="{{ item.id }}">
                        <label for="quantity_{{ item.id }}" class="form-label">Quantity</label>
                        <input type="number" class="form-control mb-2" id="quantity_{{ item.id }}" name="quantity" value="1" min="1" max="{{ item.quantity }}" {% if not item.in_stock %}disabled{% endif %}>
                        {% if order_form.errors and submitted_item_id == item.id|stringformat:"s" %}
                            {% if order_form.non_field_errors %}
                                <div class="text-danger small">{{ order_form.non_field_errors|striptags }}</div>
                            {% endif %}
                            {% if order_form.quantity.errors %}
                                <div class="text-danger small">{{ order_form.quantity.errors|striptags }}</div>
                            {% endif %}
                        {% endif %}
                        <button type="submit" class="btn btn-primary w-100" {% if not item.in_stock %}disabled{% endif %}>Order</button>
                    </form>
                </div>
            </div>
        </div>
    {% empty %}
        <div class="col-12">
            <div class="alert alert-info">No items found. Add products in the inventory page.</div>
        </div>
    {% endfor %}
</div>
{% endblock %}
